# Malware POC

## Background
* This project combine the others into sophisticated Malware with special capabilities.  
* Assume this malware is part of multi-stage attack thus the attacker deliver the malware and the db.log file.
* You can create the db.log with embedded Extended-Attributes using the project: PlayWithNTFS (in this solution).
---

## Main features
* Hidden shellcode using NTFS Extended-Attributes.
* Persistence using Windows Registry run keys.
* Injection using share memory.
* 
---

# Notes about embedding resource 
* Embedding resource in PE file using Visual Studio - https://www.ired.team/offensive-security/code-injection-process-injection/loading-and-executing-shellcode-from-portable-executable-resources#embedding-the-shellcode-as-a-resource
* The malicious DLL placed in the project directory named: "UPDATER".
*  To change the resource relative path check: "Malware.rc" file. (how to use the correct path: https://stackoverflow.com/a/33848803)
*  To use <code>FindResource</code> function you need to use <code>MAKEINTRESOURCE</code>" macro with the given name of the resource.
*  In my case:
```Cpp
hDllResource = FindResource(
    nullptr,                            
    MAKEINTRESOURCE(IDR_UPDATER1),     // Convert the resource ID to String
    _T(RESOURCE_NAME)                  // Name of the resource = "UPDATER"
);
```
---

# Notes about paths in windows:
* Windows has two types of paths: DOS form and NT form. 
* When preforms API calls we should check whether the function accept NT/DOS form and call with the correct form, otherwise the class will fail.
* [Pavel Yosifovich](https://github.com/zodiacon) demonstrate how to convert between the to forms using the combination of: <code>GetLogicalDrives</code> <code>QueryDosDevice</code> functions.
* Based on [Pavel Yosifovich](https://github.com/zodiacon) I've wrote my own implementation.

## Useful links:
* WinAPI for loading resources - https://docs.microsoft.com/en-us/windows/win32/menurc/finding-and-loading-resources
* 

